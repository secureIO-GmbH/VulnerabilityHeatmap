import { normalize } from "./threadfix.js";
import data from "./threadfix_response.json" assert { type: "json" };
import assert from "assert";

describe("Normalize - Threadfix", function () {
  describe("#normalize()", function () {
    it("should normalize threadfix response to a unified data structure", function () {
      const normalizedData = normalize(data);

      const testApp = normalizedData.find(function (app) {
        return app.name === "Application-2-Test-App";
      });

      //   console.log(testApp);

      assert.equal(testApp.name, "Application-2-Test-App");

      assert.equal(testApp.scans.length > 0, true);
      assert.equal(testApp.scans[0].importTime > 0, true);
      assert.equal(testApp.scans[0].scannerName, "KiuwanLibraries");
      assert.equal(testApp.scans[0].numberTotalVulnerabilities >= 0, true);
      assert.equal(testApp.scans[0].numberCriticalVulnerabilities >= 0, true);
      assert.equal(testApp.scans[0].numberHighVulnerabilities >= 0, true);
      assert.equal(testApp.scans[0].numberMediumVulnerabilities >= 0, true);
      assert.equal(testApp.scans[0].numberLowVulnerabilities >= 0, true);
      assert.equal(testApp.scans[0].numberInfoVulnerabilities >= 0, true);
    });
  });
});
