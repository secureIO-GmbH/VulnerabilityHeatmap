# We want a "distroless" base image
# See https://edu.chainguard.dev/chainguard/chainguard-images/getting-started/getting-started-node/
# Image specs: https://edu.chainguard.dev/chainguard/chainguard-images/reference/node/image_specs/
FROM cgr.dev/chainguard/node:latest

ENV PORT=9877
ENV HTTPS_PORT=9443
ENV NODE_ENV=production

WORKDIR /app

COPY --chown=node:node ["index.html", "package.json", "index.css", "package-lock.json", "./"]
COPY --chown=node:node ["frontend/*", "./frontend/"]
COPY --chown=node:node ["backend/", "./backend/"]
COPY --chown=node:node ["backend/adapters", "./backend/adapters"]
COPY --chown=node:node ["backend/certs", "backend/certs"]

RUN npm install --omit-dev

CMD [ "backend/server.js" ]
